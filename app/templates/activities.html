{% extends "base.html" %}

{% block content %}
<section class="section container reveal">
  <div class="section-header">
    <h1>Actividades</h1>
    {% if user and (user.permissions.activities or user.permissions.activities_supervised) %}
    <a class="button" href="/actividades/nueva">Nueva actividad</a>
    {% endif %}
  </div>
  <h2>Próximas actividades</h2>
  {% if upcoming_entries %}
  <div class="cards cards--three">
    {% for entry in upcoming_entries %}
    <article class="card">
      {% if entry.image_url %}
      <img src="{{ entry.image_url }}" alt="{{ entry.title }}" />
      {% endif %}
      <div class="card-content">
        <h3>{{ entry.title }}</h3>
        {% if entry.celebration_at_display %}
        <p class="card-meta">{{ entry.celebration_at_display }}</p>
        {% endif %}
        <p>{{ entry.summary }}</p>
        <a class="button ghost" href="/actividades/{{ entry._id }}">Ver más</a>
      </div>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <p class="muted">No hay actividades previstas en este momento.</p>
  {% endif %}
</section>

<section class="section container reveal">
  <h2>Actividades pasadas</h2>
  <div class="blog-list">
    {% for entry in entries %}
    <article class="blog-item">
      <div>
        <h3>{{ entry.title }}</h3>
        {% if entry.celebration_at_display %}
        <p class="card-meta">{{ entry.celebration_at_display }}</p>
        {% endif %}
        <p>{{ entry.summary }}</p>
      </div>
      <a class="button ghost" href="/actividades/{{ entry._id }}">Ver actividad</a>
    </article>
    {% else %}
    {% for _ in range(5) %}
    <article class="blog-item placeholder-card">
      <div>
        <h3>Actividad en preparación</h3>
        <p>Estamos organizando nuevas observaciones y talleres.</p>
      </div>
      <span class="muted">Muy pronto</span>
    </article>
    {% endfor %}
    {% endfor %}
  </div>
  <div class="pagination">
    {% if page > 1 %}
    <a class="button ghost" href="/actividades?page={{ page - 1 }}">Anterior</a>
    {% endif %}
    <span>Página {{ page }} de {{ total_pages }}</span>
    {% if page < total_pages %}
    <a class="button ghost" href="/actividades?page={{ page + 1 }}">Siguiente</a>
    {% endif %}
  </div>
</section>

{% if draft_entries %}
<section class="section container reveal">
  <h2>Borradores</h2>
  <div class="blog-list">
    {% for entry in draft_entries %}
    <article class="blog-item">
      <div>
        <h3>{{ entry.title }}</h3>
        <span class="visibility-badge">Oculto</span>
        {% if entry.celebration_at_display %}
        <p class="card-meta">{{ entry.celebration_at_display }}</p>
        {% endif %}
        <p>{{ entry.summary }}</p>
      </div>
      <div class="actions">
        <a class="button ghost" href="/actividades/{{ entry._id }}">Ver</a>
        {% if can_manage_drafts %}
        <a class="button ghost" href="/actividades/{{ entry._id }}/editar">Editar</a>
        <form method="post" action="/actividades/{{ entry._id }}/publicar">
          <button class="button ghost" type="submit">Publicar</button>
        </form>
        <form method="post" action="/actividades/{{ entry._id }}/eliminar" onsubmit="return confirm('¿Seguro que quieres eliminar esta actividad?');">
          <button class="button ghost" type="submit">Eliminar</button>
        </form>
        {% endif %}
      </div>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endblock %}
