{% extends "base.html" %}

{% block extra_head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/material-darker.min.css" />
{% endblock %}

{% block content %}
<section class="section container reveal">
  <h1>Editar entrada</h1>
  <form class="form" method="post" enctype="multipart/form-data">
    <label>Título
      <input type="text" name="title" value="{{ entry.title }}" required />
    </label>
    <label>Resumen
      <textarea name="summary" rows="3" required>{{ entry.summary }}</textarea>
    </label>
    <label>Autor (opcional)
      <input type="text" name="author_name" value="{{ entry.author_name }}" />
    </label>
    <label>Cambiar imagen principal
      <input type="file" name="image" accept="image/*" />
    </label>
    <label class="rich-editor__switch">
      <input type="checkbox" class="rich-editor__toggle-input" name="show_author" {% if entry.show_author %}checked{% endif %} />
      <span class="rich-editor__switch-slider"></span>
      <span class="rich-editor__switch-text">Mostrar autor en la publicación</span>
    </label>
    <label class="rich-editor__switch">
      <input type="checkbox" class="rich-editor__toggle-input" name="show_image" {% if entry.show_image %}checked{% endif %} />
      <span class="rich-editor__switch-slider"></span>
      <span class="rich-editor__switch-text">Mostrar imagen principal en la entrada</span>
    </label>
    {% if user.permissions.blog %}
    <label class="rich-editor__switch">
      <input type="checkbox" class="rich-editor__toggle-input" name="is_hidden" {% if entry.is_hidden %}checked{% endif %} />
      <span class="rich-editor__switch-slider"></span>
      <span class="rich-editor__switch-text">Marcar como oculta</span>
    </label>
    {% endif %}
    {% if user.is_admin %}
    <label>Fecha de publicación
      <input type="datetime-local" name="published_at" value="{{ entry.published_at_input }}" />
    </label>
    {% endif %}
    <div class="rich-editor" data-rich-editor>
      <div class="rich-editor__header">
        <span class="rich-editor__label">Contenido</span>
        <label class="rich-editor__switch">
          <input type="checkbox" class="rich-editor__toggle-input" />
          <span class="rich-editor__switch-slider"></span>
          <span class="rich-editor__switch-text">Editar HTML sin formato</span>
        </label>
      </div>
      <div class="rich-editor__quill" data-rich-editor-quill></div>
      <textarea class="rich-editor__textarea" name="content_html" rows="12">{{ entry.content_html }}</textarea>
    </div>
    <button class="button" type="submit">Guardar cambios</button>
  </form>
  <form class="form" method="post" action="/blog/{{ entry._id }}/eliminar" onsubmit="return confirm('¿Seguro que quieres eliminar esta entrada?');">
    <button class="button danger" type="submit">Eliminar entrada</button>
  </form>
</section>
{% endblock %}

{% block extra_scripts %}
  <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/xml/xml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/javascript/javascript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/css/css.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
  <script defer src="/static/js/rich_text.js"></script>
{% endblock %}
