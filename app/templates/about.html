{% extends "base.html" %}

{% block extra_head %}
  {% if user and user.is_admin %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/material-darker.min.css" />
  {% endif %}
{% endblock %}

{% block content %}
<section class="section container reveal">
  {% if user and user.is_admin %}
  <div class="about-actions">
    <button class="button ghost" type="button" data-about-toggle>Editar</button>
  </div>
  <form class="form about-editor hidden" method="post" data-about-form>
    <p>Puedes añadir HTML en el contenido para dar formato.</p>
    <div class="rich-editor" data-rich-editor>
      <div class="rich-editor__header">
        <span class="rich-editor__label">Contenido</span>
        <label class="rich-editor__switch">
          <input type="checkbox" class="rich-editor__toggle-input" />
          <span class="rich-editor__switch-slider"></span>
          <span class="rich-editor__switch-text">Editar HTML sin formato</span>
        </label>
      </div>
      <div class="rich-editor__quill" data-rich-editor-quill></div>
      <textarea class="rich-editor__textarea" name="content_html" rows="16">{{ content_html | e }}</textarea>
    </div>
    <button class="button" type="submit">Actualizar texto</button>
  </form>
  {% endif %}
  <div class="blog-content about-content">{{ content_html | safe }}</div>
</section>
{% endblock %}

{% block extra_scripts %}
  {% if user and user.is_admin %}
  <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/xml/xml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/javascript/javascript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/css/css.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
  <script defer src="/static/js/rich_text.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.querySelector('[data-about-toggle]');
      const form = document.querySelector('[data-about-form]');
      if (!toggle || !form) {
        return;
      }
      toggle.addEventListener('click', () => {
        form.classList.toggle('hidden');
        toggle.textContent = form.classList.contains('hidden') ? 'Editar' : 'Cerrar edición';
        if (!form.classList.contains('hidden')) {
          form.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  </script>
  {% endif %}
{% endblock %}
