{% extends "base.html" %}

{% block content %}
<section class="section container reveal">
  <div class="section-header">
    <h1>Astrofotografía</h1>
    <button class="button ghost small" type="button" data-astrofoto-filter-toggle>Filtrar</button>
  </div>
  <div class="astrofoto-filters" data-astrofoto-filters>
    <div class="astrofoto-filters__fields">
      <label>
        <span>Autor</span>
        <select data-astrofoto-filter="author">
          <option value="all">Todos los autores</option>
          {% for author in authors %}
          <option value="{{ author }}">{{ author }}</option>
          {% endfor %}
        </select>
      </label>
      <label>
        <span>Fecha de subida</span>
        <input type="date" data-astrofoto-filter="date" />
      </label>
    </div>
    <button class="button ghost small" type="button" data-astrofoto-filter-reset>Limpiar filtros</button>
  </div>
  <div class="astrofoto-gallery" data-astrofoto-gallery>
    {% for photo in photos %}
    <a class="photo-card" href="/astrofotos/{{ photo._id }}" data-astrofoto-card data-author="{{ photo.author }}" data-date="{{ photo.uploaded_at_iso }}">
      <img src="{{ photo.image_url }}" alt="{{ photo.name }}" />
      <div class="photo-info">
        <h3>{{ photo.name }}</h3>
        {% if user and photo.is_hidden %}
        <span class="visibility-badge">Oculto</span>
        {% endif %}
        <div class="photo-info__meta">
          <p>{{ photo.author }}</p>
          <span>{{ photo.uploaded_at_display }}</span>
        </div>
      </div>
    </a>
    {% else %}
    {% for _ in range(6) %}
    <div class="photo-card placeholder-card">
      <div class="placeholder-thumb"></div>
      <div class="photo-info">
        <h3>Astrofoto en preparación</h3>
        <p>Pronto tendremos nuevas imágenes.</p>
      </div>
    </div>
    {% endfor %}
    {% endfor %}
  </div>
  <div class="astrofoto-pagination" data-astrofoto-pagination></div>
</section>

{% if user and (user.permissions.photos or user.permissions.photos_supervised) %}
<section class="section container reveal">
  <div class="section-header">
    <h2>Subir nuevas imágenes</h2>
    <button class="button ghost" type="button" data-toggle="astrofoto-upload">Subir nuevas imágenes</button>
  </div>
  <div id="astrofoto-upload" class="card hidden">
    <div class="card-content">
      <p class="muted">Completa los datos y comparte tu última captura con la comunidad.</p>
      <form class="form" method="post" enctype="multipart/form-data">
        <label>Nombre
          <input type="text" name="name" required />
        </label>
        <label>Características
          <input type="text" name="characteristics" />
          <span class="muted">Tiempo de exposición, filtros...</span>
        </label>
        <label>Equipo usado
          <input type="text" name="equipment" />
        </label>
        <label>Descripción
          <textarea name="description" rows="3"></textarea>
        </label>
        <label>Autor
          <input type="text" name="author" value="{{ author_default }}" required />
        </label>
        <label>Archivo de imagen
          <input type="file" name="photo_file" accept="image/*" required />
        </label>
        <div class="astrofoto-versions" data-astrofoto-versions-form>
          <div class="section-header">
            <h3>Otras versiones</h3>
            <button class="button ghost small" type="button" data-astrofoto-add-version>Agregar versión</button>
          </div>
          <p class="muted">Puedes añadir versiones alternativas con su propia descripción.</p>
          <div class="astrofoto-versions__list" data-astrofoto-versions-list></div>
        </div>
        <div class="form-actions">
          {% if user.permissions.photos %}
          <button class="button" type="submit" name="submission_action" value="publish">Publicar foto</button>
          {% endif %}
          <button class="button ghost" type="submit" name="submission_action" value="review">Enviar para revisión</button>
        </div>
      </form>
    </div>
  </div>
</section>
{% endif %}
{% endblock %}
